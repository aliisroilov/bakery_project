{% extends "base.html" %}
{% load humanize %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 py-10">
  <!-- Header -->
  <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-8 gap-4">
    <div>
      <h1 class="text-3xl sm:text-4xl font-bold text-[#8A6233]">Xodimlar maoshi</h1>
      <p class="text-[#B67B3F]/70 mt-1">Hisoblangan va to‘langan maoshlar ro‘yxati</p>
    </div>

    <div class="bg-[#FFF9F3] border border-[#E6B566]/50 rounded-2xl px-6 py-3 shadow-sm text-center sm:text-right">
      <span class="block text-sm text-[#8A6233]/80">Kassa balansi</span>
      <span class="text-xl font-semibold text-[#B67B3F]">{{ balance|floatformat:0|intcomma }} soʻm</span>
    </div>
  </div>

  <!-- Employee Cards -->
  {% if employees %}
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
    {% for emp in employees %}
    <div class="bg-white/90 backdrop-blur-xl border border-[#E6B566]/40 rounded-3xl shadow-md hover:shadow-lg transition-all duration-200 p-6 flex flex-col justify-between">
      <!-- Header: name & role -->
      <div class="flex justify-between items-start mb-4">
        <div>
          <h2 class="text-xl font-semibold text-[#8A6233]">
            {{ emp.user.get_full_name|default:emp.user.username }}
          </h2>
          <p class="text-sm text-[#B67B3F]/70 capitalize">{{ emp.user.role }}</p>
        </div>
      </div>

      <!-- Salary info -->
      <div class="space-y-2 text-sm">
        <div class="flex justify-between">
          <span class="text-[#8A6233]/70">Hisoblangan:</span>
          <span class="font-semibold text-[#8A6233]">
            {{ emp.earned|floatformat:0|intcomma }} soʻm
          </span>
        </div>

        <div class="flex justify-between">
          <span class="text-[#8A6233]/70">Oxirgi to‘lov:</span>
          {% if emp.last_paid %}
          <span class="font-semibold text-[#8A6233]">
            {{ emp.last_paid|floatformat:0|intcomma }} soʻm
          </span>
          {% else %}
          <span class="text-gray-400 italic">To‘lov yo‘q</span>
          {% endif %}
        </div>

        <div class="flex justify-between">
          <span class="text-[#8A6233]/70">Sana:</span>
          {% if emp.last_paid_date %}
          <span class="font-medium text-[#8A6233]/80">{{ emp.last_paid_date }}</span>
          {% else %}
          <span class="text-gray-400 italic">–</span>
          {% endif %}
        </div>
      </div>

      <!-- Buttons -->
      <div class="mt-6 flex flex-col sm:flex-row gap-3">
        <a href="{% url 'salary:pay_salary' emp.user.id %}"
           class="flex-1 text-center px-5 py-2 bg-[#E6B566] hover:bg-[#B67B3F] text-white rounded-xl text-sm font-medium shadow-md transition duration-200">
          To‘lov / Avans
        </a>
        <a href="{% url 'salary:salary_history' emp.user.id %}"
           class="flex-1 text-center px-5 py-2 bg-[#FFF9F3] hover:bg-[#E6B566]/30 text-[#8A6233] border border-[#E6B566]/50 rounded-xl text-sm font-medium shadow-sm transition duration-200">
          Oyliklar tarixi
        </a>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="text-center py-16 bg-[#FFF9F3] border border-[#E6B566]/40 rounded-3xl">
    <p class="text-lg text-[#8A6233]/70">Xodimlar topilmadi.</p>
  </div>
  {% endif %}
</div>
{% endblock %}
