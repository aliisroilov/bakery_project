{% extends "base.html" %}
{% load humanize %}
{% block content %}

<div class="max-w-7xl mx-auto px-4 sm:px-6 py-10">
  <!-- Header -->
  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 gap-6">
    <div>
      <h1 class="text-3xl font-bold" style="color:#b5793b;">Sotuvlar hisobotlari</h1>
      <p class="text-sm" style="color:#bea087;">Yetkazilgan va qisman yetkazilgan buyurtmalar ro‘yxati</p>
    </div>

    <!-- Filter Form -->
    <form method="get" class="flex flex-wrap gap-4 items-end bg-[#dcc38b]/10 p-3 sm:p-4 rounded-xl border border-[#bea087]/30 shadow-sm">
      <div class="flex flex-col">
        <label class="text-sm font-medium mb-1" style="color:#b5793b;">Boshlanish sanasi</label>
        <input type="date" name="start_date" value="{{ start_date }}"
               class="border rounded-lg px-2 py-2 text-sm border-[#bea087]/50 focus:outline-none focus:ring-2 focus:ring-[#dcc38b] bg-white" />
      </div>
      <div class="flex flex-col">
        <label class="text-sm font-medium mb-1" style="color:#b5793b;">Tugash sanasi</label>
        <input type="date" name="end_date" value="{{ end_date }}"
               class="border rounded-lg px-2 py-2 text-sm border-[#bea087]/50 focus:outline-none focus:ring-2 focus:ring-[#dcc38b] bg-white" />
      </div>
      <button type="submit"
              class="rounded-lg px-4 py-2 font-semibold text-sm transition-all hover:opacity-90 shadow-sm"
              style="background-color:#b5793b; color:#dcc38b;">
        Filtrlash
      </button>
    </form>
  </div>

  <!-- Table Section -->
  <div class="bg-white rounded-2xl shadow-md border border-[#bea087]/30 overflow-hidden">
    <!-- Responsive scroll wrapper (only if needed) -->
    <div class="table-responsive" style="overflow-x:auto; -webkit-overflow-scrolling:touch;">
      <table class="sales-table min-w-full text-sm text-left border-collapse">
        <thead style="background-color:#b5793b; color:#dcc38b;">
          <tr>
            <th class="th-date">Sana</th>
            <th class="th-product">Mahsulot nomi</th>
            <th class="th-qty">Soni</th>
            <th class="th-shop">Kontragent</th>
          </tr>
        </thead>
        <tbody>
          {% if product_sales %}
            {% for item in product_sales %}
              <tr class="border-b border-[#bea087]/20 hover:bg-[#dcc38b]/10 transition-colors">
                <td class="td-date">
                  {{ item.order__created_at|date:"M d" }} 
                </td>

                <!-- product name will truncate if too long -->
                <td class="td-product" title="{{ item.product__name }}">
                  {{ item.product__name }}
                </td>

                <td class="td-qty text-center">
                  {{ item.quantity_sold|intcomma }}
                </td>

                <td class="td-shop">
                  {{ item.order__shop__name }}
                </td>
              </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="4" class="py-6 text-center text-[#bea087]">
                Hozircha ma’lumot mavjud emas.
              </td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Summary -->
  <div class="mt-6 sm:mt-8 text-right">
    <span class="text-lg font-semibold" style="color:#b5793b;">
      Jami sotilgan mahsulotlar:
      <span class="text-[#dcc38b]">{{ total|intcomma }}</span> dona
    </span>
  </div>
</div>

<!-- Styling tuned for phones and desktop -->
<style>
  /* base table styles */
  .sales-table {
    width: 100%;
    border-collapse: collapse;
    table-layout: fixed; /* critical: keeps columns proportional and allows truncation */
    min-width: 650px;    /* desktop comfortable width; small screens will scroll if necessary */
  }
  .sales-table thead th {
    padding: 12px 10px;
    font-weight: 600;
    text-align: left;
    vertical-align: middle;
  }
  .sales-table tbody td {
    padding: 10px 10px;
    vertical-align: middle;
    color: #b5793b;
    white-space: nowrap; /* keep cells single-line for consistent table feel */
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* column widths (proportional) */
  .th-date, .td-date { width: 18%; min-width: 80px; }
  .th-product, .td-product { width: 44%; min-width: 160px; }
  .th-qty, .td-qty { width: 12%; min-width: 60px; }
  .th-shop, .td-shop { width: 26%; min-width: 120px; }

  /* small-screen tweaks */
  @media (max-width: 640px) {
    .sales-table { min-width: 0; table-layout: fixed; } /* allow table to shrink to container */
    .sales-table thead th { padding: 8px 6px; font-size: 0.85rem; }
    .sales-table tbody td { padding: 8px 6px; font-size: 0.9rem; }

    /* tighter widths on phones */
    .th-date, .td-date { width: 20%; min-width: 60px; }
    .th-product, .td-product { width: 40%; min-width: 120px; }
    .th-qty, .td-qty { width: 12%; min-width: 40px; }
    .th-shop, .td-shop { width: 28%; min-width: 90px; }

    /* allow product to truncate rather than push spacing */
    .td-product { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

    /* remove trailing right-gap by ensuring cell padding is compact */
    .sales-table tbody td:last-child { padding-right: 6px; }
    .sales-table thead th:last-child { padding-right: 6px; }
  }

  /* ensure the scroll container is visible and only scrolls horizontally when necessary */
  .table-responsive { width: 100%; display: block; }

  /* nice touch for the horizontal scrollbar */
  .table-responsive::-webkit-scrollbar { height: 6px; }
  .table-responsive::-webkit-scrollbar-thumb { background: #b5793b; border-radius: 10px; }
</style>

{% endblock %}
